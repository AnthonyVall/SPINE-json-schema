{
  "$id":"https://raw.githubusercontent.com/SPINEProject/SPINE-json-schema/master/schemas/annotation.schema.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Annotation Schema",
  "type": "object",
  "TODOS": [
    "Usually an annotation is a simple comment. In the future an annotation can be an image, for instance a probability mask. This can be the answer to the question, what is the probability for every voxel to be part of the corpus callosum."
  ],
  "definitions": {

    "annotationBasic":{
      "$id": "#annotationBasic",
      "description": "Basic description of an annotation",
      "properties":{
        "answerFormat": {
          "type": "string",
          "enum": ["TEXT","NUMBER"]
        },
        "hasAnswer": {
          "description": "If no answer then there are no annotation properties",
          "type": "boolean"
        },
        "status": {
          "description": "Status of the annotation: saved or submitted",
          "type": "string",
          "enum": ["SAVED","SUBMITTED"]
        },
        "reference": {
          "description": "References to main documents",
          "type": "object",
          "properties": {
            "roiId": {
              "description": "Id of the ROI annotated by this annotation",
              "type": "string"
            },
            "taskId": {
              "description": "Id of the task used to produce this annotation",
              "type": "string"
            },
            "workflowId": {
              "description": "Id of the workflow used to produce this annotation",
              "type": "string"
            },
            "materializedTaskId": {
              "description": "Id of the materialized task used to created the ROI. If not set then the materialized task has not been submitted.",
              "type": "string"
            },
            "workflowExecutorId": {
              "description": "Id of the workflow executor used to created the ROI. This is used in case the workflow has not been run inside SPINE, thus there is no materialized task associated.",
              "type": "string"
            },
            "questionId":{
              "description": "Id of the question related to this annotation. An annotation is an answer to a question.",
              "type": "string"
            }
          },
          "oneOf":[
            { "required": ["roiId", "taskId", "workflowId", "materializedTaskId", "workflowExecutorId", "questionId"] },
            { "required": ["roiId", "workflowId", "workflowExecutorId", "questionId"] }
          ],
          "additionalProperties": false
        }
      },
      "required": ["typeQuestion", "typeAnnotation", "status", "reference"]
    },

    "annotationMultipleChoiceMultipleAnswer":{
      "$id": "#annotationMultipleChoiceMultipleAnswer",
      "description": "Description an annotation with multiple answers.",
      "allOf": [
        { "$ref": "#/definitions/annotationBasic" },
        {
          "properties":{
            "answerType": {
              "enum": ["MULTIPLE_CHOICE_MULTIPLE_ANSWER"]
            },
            "annotationProperties":{
              "values": {
                "description": "List of multiple values selected.",
                "type": "array",
                "items": {
                  "type": "object",
                  "properties":{
                    "label": { "type":"string" },
                    "ontologyId": { "type":"string" },
                    "ontologyClassIri": { "type":"string" }
                  }
                }
              }
            }
          }
        }
      ]
    },

    "annotationMultipleChoiceSingleAnswer":{
      "$id": "#annotationMultipleChoiceSingleAnswer",
      "description": "Description an annotation with a single answers.",
      "allOf": [
        { "$ref": "#/definitions/annotationBasic" },
        {
          "properties":{
            "answerType": {
              "enum": ["MULTIPLE_CHOICE_SINGLE_ANSWER"]
            },
            "annotationProperties":{
              "value": {
                "description": "List of multiple values selected.",
                "type": "object",
                "properties":{
                  "label": { "type":"string" },
                  "ontologyId": { "type":"string" },
                  "ontologyClassIri": { "type":"string" }
                }
              }
            }
          }
        }
      ]
    },

    "annotationOpenEnded":{
      "$id": "#annotationOpenEnded",
      "description": "Description an openended annotation.",
      "allOf": [
        { "$ref": "#/definitions/annotationBasic" },
        {
          "properties":{
            "answerType": {
              "enum": ["OPEN_ENDED"]
            },
            "annotationProperties":{
              "value": {
                "description": "Text in the open-ended question.",
                "type": "string",
              }
            }
          }
        }
      ]
    }

  },
  "oneOf": [
    { "$ref": "#/definitions/annotationMultipleChoiceMultipleAnswer" },
    { "$ref": "#/definitions/annotationMultipleChoiceSingleAnswer" },
    { "$ref": "#/definitions/annotationOpenEnded" }
  ]
}
